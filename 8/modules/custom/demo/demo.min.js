function demo_form_alter(a,b,c){return new Promise(function(b,d){a.actions&&(a.actions._weight=999),"UserLoginForm"==c&&(a.name._value="demo",a.pass._value="drupalgap2012"),b()})}function demo_block_view_alter(a,b){switch(b.get("id")){case"main_menu":"burrito"==dg.config("theme").name&&(a.menu._items=[]),a.menu._items.push(dg.l(dg.t("Map"),"map"),dg.l(dg.t("Messages"),"messages"),dg.l(dg.t("Tour"),"tour"))}}function demo_entity_view(a,b){if("node"==b.getEntityType()&&"article"==b.getBundle()){var c=dg.currentUser();if(c.isAuthenticated()){var d={},e={};demo.isBootstrap()?(d={"class":["text-right"]},e={"class":["btn","btn-sm","btn-success"]}):demo.isFoundation()&&(d={"class":["float-right"]},e={"class":["button","success"]}),a.controls={_theme:"container",_attributes:d,_children:{_edit:{_markup:dg.l(dg.t("Edit"),"node/"+b.id()+"/edit",{_attributes:e})}}}}a.map=demo.getMapRenderElement(),a.map._postRender.push(function(){var a=new google.maps.LatLng(b.get("field_latitude",0).value,b.get("field_longitude",0).value);new google.maps.Marker({position:a,map:demo.map,icon:"http://maps.google.com/mapfiles/ms/icons/green-dot.png"});demo.map.panTo(a),demo.map.setZoom(7)})}else if("user"==b.getEntityType()){var f=new Date(1e3*b.get("created",0).value);a.member_for={_theme:"container",_children:{date:{_markup:"<h4>"+dg.t("Member since")+"</h4>"+f.toDateString()}}}}}var demo=new dg.Module;dg.modules.demo=demo,demo.userLatitude=null,demo.userLongitude=null,demo.map=null,demo.routing=function(){var a={};return a["demo.welcome"]={path:"/welcome",defaults:{_title:"Welcome",_controller:demo.welcomePage}},a["demo.tour"]={path:"/tour",defaults:{_title:"Tour",_controller:demo.tourPage}},a["demo.map"]={path:"/map",defaults:{_title:"Map",_controller:demo.mapPage}},a["demo.messages"]={path:"/messages",defaults:{_title:"Messages",_controller:demo.messagesPage}},a},demo.blocks=function(){var a={};return a.switch_css_framework={build:function(){return new Promise(function(a,b){dg.addForm("DemoSwitchForm",dg.applyToConstructor(DemoSwitchForm)).getForm().then(function(b){var c={};!demo.cssFrameworkSwitched()&&demo.outOfTheBox()&&(c.msg={_theme:"message",_type:"warning",_message:dg.t("Hey, try switching the mode!")}),c.form={_markup:b},a(c)})})}},a},demo.welcomePage=function(){return new Promise(function(a,b){var c=(dg.currentUser(),{});demo.outOfTheBoxAndAnonymous()&&!demo.cssFrameworkSwitched()?(c.intro={_theme:"item_list",_type:"ol",_items:[dg.t("Agree this demo looks boring"),dg.t("Know that DrupalGap 8 is an empty canvas for developers"),dg.l("Get ready")]},c.expectations={_theme:"item_list",_title:{_markup:"<h3>"+dg.t("What to expect")+"</h3><p>"+dg.t("A simple headless Drupal 8 web application...")+"</p>"},_items:[dg.t("to add a message to a map"),dg.t("to browse other messages"),dg.t("with a surprise or two")],_suffix:dg.l(dg.t("Continue the demo"),"map")}):(c.intro=demo.showcase(),c.start={_theme:"item_list",_title:dg.t("Getting Started"),_items:[dg.l(dg.t("Hello world"),"http://docs.drupalgap.org/8/Hello_World"),dg.l(dg.t("See the demo's source code"),"https://github.com/signalpoint/drupalgap_demo/tree/8.x-1.x/8")]}),a(c)})},demo.tourPage=function(){return new Promise(function(a,b){var c=(dg.currentUser(),{});c.intro=demo.showcase(),c.features={_markup:"<h2>"+dg.t("Tools and Features")+"</h2><blockquote>"+dg.t("By utilizing familiar coding syntax and concepts from Drupal 8 such as...")+"</blockquote>"+dg.theme("item_list",{_items:[dg.t("Entities / Fields"),dg.t("Modules"),dg.t("Hooks"),dg.t("Themes"),dg.t("Regions"),dg.t("Blocks"),dg.t("Templates"),dg.t("Routes / Custom Pages"),dg.t("Forms API"),dg.t("User Roles / Permissions")]})+"<blockquote>"+dg.t("with built in pages, widgets and forms to handle...")+"</blockquote>"+dg.theme("item_list",{_items:[dg.t("User Authentication"),dg.t("Adding / Editing Entities"),dg.t("Displaying Entities / Fields"),dg.t("Rendering Views Result Data")]})+"<blockquote>"+dg.t("the DrupalGap tool set is dedicated to Drupal 8 application development.")+"</blockquote>"},a(c)})},demo.mapPage=function(){return new Promise(function(a,b){var c=dg.currentUser(),d={};if(d.map=demo.getMapRenderElement(),d.map._postRender.push(function(){jDrupal.viewsLoad("articles").then(function(a){for(var b=a.getResults(),c=[],d=0;d<b.length;d++){var e=new jDrupal.Node(b[d]),f=new google.maps.Marker({position:new google.maps.LatLng(e.get("field_latitude",0).value,e.get("field_longitude",0).value),map:demo.map,icon:"http://maps.google.com/mapfiles/ms/icons/green-dot.png"});c.push(f);var g=dg.l(e.getTitle(),"node/"+e.id()),h=new google.maps.InfoWindow;google.maps.event.addListener(f,"click",function(a,b,c){return function(){c.setContent(b),c.open(demo.map,a)}}(f,g,h))}for(var i=new google.maps.LatLngBounds,d=0;d<c.length;d++)i.extend(c[d].getPosition());window.setTimeout(function(){demo.map.fitBounds(i)},100)})}),d.message={_markup:'<div id="demo-message"></div>',_weight:2},c.isAuthenticated()){if(window.localStorage.getItem("demo_message_sent"))return d.message._postRender=[function(){var a=window.localStorage.getItem("demo_message_sent");demo.setMessage({_theme:"message",_type:"warning",_message:dg.t("You already sent a message!")+" ("+dg.l(dg.t("view message"),"node/"+a)+")"})}],void a(d);d.message._postRender=[function(){demo.setMessage({_theme:"message",_type:"info",_message:dg.t("Click on the map and enter your message below...")+" "+dg.l(dg.t("or use your current location"),null,{_attributes:{href:"",onclick:"demo.getCurrentLocation(); return false;"}})})}],dg.addForm("DemoSayHelloForm",dg.applyToConstructor(DemoSayHelloForm)).getForm().then(function(b){d.say_hello_form={_markup:b,_weight:2},a(d)})}else d.message._postRender=[function(){window.localStorage.getItem("demo_message_sent");demo.setMessage({_theme:"message",_message:dg.t("Login to add a greeting to the map.")})}],a(d)})},demo.messagesPage=function(){return new Promise(function(a,b){var c={};c.article_list=dg.recentGreetings(),a(c)})};var DemoSwitchForm=function(){this.buildForm=function(a,b){return new Promise(function(b,c){demo.outOfTheBox&&a._attributes["class"].push("out-of-the-box"),a.css_frameworks={_type:"select",_options:{out_of_the_box:dg.t("Default (out of the box)"),bootstrap:dg.t("Bootstrap"),foundation:dg.t("Foundation")},_value:demo.currentFramework(),_attributes:{onchange:"demo.switchFramework(this)"}},demo.outOfTheBox()&&(a.css_frameworks._title=dg.t("Mode")),demo.outOfTheBox()&&(a.css_frameworks._attributes["class"]=["out-of-the-box"]),b(a)})}};DemoSwitchForm.prototype=new dg.Form("DemoSwitchForm"),DemoSwitchForm.constructor=DemoSwitchForm;var DemoSayHelloForm=function(){this.buildForm=function(a,b){return new Promise(function(b,c){a.name={_type:"textfield",_title:"Name",_required:!0,_title_placeholder:!0},a.message={_type:"textarea",_title:"Message",_required:!0,_title_placeholder:!0},a.latitude={_type:"hidden",_title:"Latitude",_required:!0,_title_placeholder:!0},a.longitude={_type:"hidden",_title:"Longitude",_required:!0,_title_placeholder:!0},a.actions={_type:"actions",submit:{_type:"submit",_value:"Send message",_button_type:"primary"}},b(a)})},this.submitForm=function(a,b){return new Promise(function(a,c){var d=new dg.Node({type:[{target_id:"article"}],title:[{value:b.getValue("name")}],body:[{value:b.getValue("message")}],field_latitude:[{value:b.getValue("latitude")}],field_longitude:[{value:b.getValue("longitude")}]});d.save().then(function(){window.localStorage.setItem("demo_message_sent",d.id()),document.getElementById("demo-say-hello-form").style.display="none",demo.setMessage({_theme:"message",_type:"status",_message:dg.t("Message sent!")}),document.getElementById("recent-greetings").innerHTML=dg.render(dg.recentGreetings()),a()})})}};DemoSayHelloForm.prototype=new dg.Form("DemoSayHelloForm"),DemoSayHelloForm.constructor=DemoSayHelloForm,demo.currentFramework=function(){var a=document.getElementById("edit-css-frameworks");if(a)return a.value;switch(dg.config("theme").name){case"ava":return"out_of_the_box";case"burrito":return"bootstrap";case"frank":return"foundation"}},demo.switchFramework=function(a){window.localStorage.setItem("demo_css_framework_switched",1);var b=window.location.toString();switch(a.value){case"out_of_the_box":-1!=b.indexOf("foundation")?b=b.replace("foundation/",""):-1!=b.indexOf("bootstrap")&&(b=b.replace("bootstrap/",""));break;case"bootstrap":b=-1!=b.indexOf("foundation")?b.replace("foundation","bootstrap"):b.replace("8/","8/bootstrap");break;case"foundation":b=-1!=b.indexOf("bootstrap")?b.replace("bootstrap","foundation"):b.replace("8/","8/foundation")}window.location=b},demo.getMapRenderElement=function(){return{_markup:"<div "+dg.attributes({id:"demo-map"})+"></div>",_postRender:[function(){var a={center:new google.maps.LatLng(0,0),zoom:3,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL},scrollwheel:!1};demo.markersArray=[],demo.map=new google.maps.Map(document.getElementById("demo-map"),a),google.maps.event.addListener(demo.map,"click",function(a){demo.clearMarkers(),demo.setCoordinateInputs(a.latLng.lat(),a.latLng.lng());var b=new google.maps.Marker({position:a.latLng,map:demo.map});demo.markersArray.push(b)}),setTimeout(function(){google.maps.event.trigger(demo.map,"resize")},500)}],_weight:1}},dg.recentGreetings=function(){return{_theme:"view",_path:"articles",_format:"div",_attributes:{id:"recent-greetings"},_row_callback:function(a){var b=dg.Node(a),c=new Date(1e3*b.getCreatedTime());return"<h4>"+dg.l(b.getTitle(),"node/"+b.id())+" | "+c.toDateString()+"</h4><blockquote>"+b.get("body",0).value+"</blockquote>"},_weight:3}},demo.setMessage=function(a){document.getElementById("demo-message").innerHTML=dg.render(a)},demo.clearMarkers=function(){for(var a=0;a<demo.markersArray.length;a++)demo.markersArray[a].setMap(null);demo.markersArray.length=0},demo.setCoordinateInputs=function(a,b){document.getElementById("edit-latitude").value=a,document.getElementById("edit-longitude").value=b},demo.getCurrentLocation=function(){navigator.geolocation.getCurrentPosition(function(a){demo.userLatitude=a.coords.latitude,demo.userLongitude=a.coords.longitude,demo.setCoordinateInputs(demo.userLatitude,demo.userLongitude);var b=new google.maps.LatLng(demo.userLatitude,demo.userLongitude);demo.clearMarkers();var c=new google.maps.Marker({position:b,map:demo.map,icon:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png"});demo.markersArray.push(c),demo.map.panTo(b),demo.map.setZoom(11)},function(a){switch(console.log(a),dg.alert(a.message),a.code){case 1:break;case 2:break;case 3:}},{enableHighAccuracy:!0})},demo.cssFrameworkSwitched=function(){return window.localStorage.getItem("demo_css_framework_switched")},demo.showcase=function(){var a=null;switch(dg.config("theme").name){case"burrito":a=dg.t("Instantly add a _bootstrap front end to your app with a _module extension and theme for DrupalGap.",{_bootstrap:dg.l(dg.t("Bootstrap"),"http://getbootstrap.com/"),_module:dg.l(dg.t("module"),"http://drupalgap.org/project/bootstrap")});break;case"frank":a=dg.t("Instantly add a _foundation front end to your app with a _module extension and theme for DrupalGap.",{_foundation:dg.l(dg.t("Foundation"),"http://foundation.zurb.com/"),_module:dg.l(dg.t("module"),"http://drupalgap.org/project/foundation")})}return a?{_markup:"<blockquote>"+a+"</blockquote>"}:""},demo.headerBlockAccess=function(){return!(demo.outOfTheBox()&&dg.currentUser().isAnonymous()&&dg.isFrontPage()&&!demo.cssFrameworkSwitched())},demo.outOfTheBox=function(){return"ava"==dg.config("theme").name},demo.isBootstrap=function(){return"burrito"==dg.config("theme").name},demo.isFoundation=function(){return"frank"==dg.config("theme").name},demo.outOfTheBoxAndAnonymous=function(){return demo.outOfTheBox()&&dg.currentUser().isAnonymous()};